generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RawCoinPaprika {
  id         Int      @id @default(autoincrement())
  externalId String   @unique
  payload    Json
  fetchedAt  DateTime @default(now())
}

model RawCoinGecko {
  id         Int      @id @default(autoincrement())
  externalId String   @unique
  payload    Json
  fetchedAt  DateTime @default(now())
}

model NormalizedCoin {
  id           Int      @id @default(autoincrement())
  source       String
  externalId   String
  symbol       String
  name         String
  marketCap    Float?
  priceUsd     Float?
  lastUpdated  DateTime

  @@unique([source, externalId])
}

model EtlCheckpoint {
  source            String   @id
  lastProcessedAt   DateTime
}

model EtlRun {
  id                Int      @id @default(autoincrement())
  startedAt         DateTime @default(now())
  finishedAt        DateTime?
  status            String
  recordsProcessed  Int
  errorMessage      String?
}
